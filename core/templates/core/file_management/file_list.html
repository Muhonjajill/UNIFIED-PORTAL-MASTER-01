{% extends "files_base.html" %}
{% load static %}

{% block title %}File Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/file_list.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="page-title">ðŸ“‚ File Management</h2>

  <!-- Category Buttons -->
  <div class="category-nav">
    <a href="{% url 'upload_file' %}" class="upload-button">âž• Upload New File</a>
    <a href="{% url 'file_list' %}" class="{% if not active_category %}active{% endif %}">All</a>
    {% for category in categories %}
      <a href="{% url 'file_list_by_category' category.name %}" class="{% if category.name == active_category %}active{% endif %}">{{ category.name }}</a>
    {% endfor %}
  </div>

  <h3 class="section-subtitle">{% if active_category %}{{ active_category }}{% else %}All Files{% endif %}</h3>

  <div class="file-grid-header">
    <span>NAME</span>
    <span>SIZE</span>
    <span>CLASSIFICATION</span>
    <span>PREVIEW</span>
    <span>DOWNLOAD</span>
  </div>

  <div class="file-grid">
    {% for file in files %}
      <div class="file-row">
        <div class="file-name">
          {% if ".pdf" in file.file.name|lower %}
            <img src="{% static 'icons/pdf.png' %}" alt="PDF Icon" />
          {% elif ".docx" in file.file.name|lower %}
            <img src="{% static 'icons/docx.png' %}" alt="DOCX Icon" />
          {% elif ".jpg" in file.file.name|lower or ".png" in file.file.name|lower %}
            <img src="{{ file.file.url }}" alt="Image" />
          {% elif ".xlsx" in file.file.name|lower %}
            <img src="{% static 'icons/xlsx.png' %}" alt="Excel Icon" />
          {% elif ".txt" in file.file.name|lower %}
            <img src="{% static 'icons/text.png' %}" alt="Text Icon" />
          {% elif ".csv" in file.file.name|lower %}
            <img src="{% static 'icons/csv.png' %}" alt="CSV Icon" />
          {% elif ".xml" in file.file.name|lower %}
            <img src="{% static 'icons/xml.png' %}" alt="XML Icon" />
          {% elif ".ppt" in file.file.name|lower %}
            <img src="{% static 'icons/ppt.png' %}" alt="PPT Icon" />
          {% else %}
            <img src="{% static 'icons/file.png' %}" alt="File Icon" />
          {% endif %}
          <div class="file-title-group">
            <span class="file-title">{{ file.title }}</span>
            <small class="file-description">{{ file.description|truncatechars:60 }}</small>
          </div>
        </div>
        <div>{{ file.file.size|filesizeformat }}</div>
        <div><span class="tag {{ file.access_level }}">{{ file.access_level|title }}</span></div>
        <div>
          <a href="{% url 'preview_file' file.id %}" class="btn preview-link" target="_blank">Preview</a>
        </div>
        <div>
          <a href="{{ file.file.url }}" class="btn download-link" download>Download</a>
        </div>
      </div>
    {% empty %}
      <div class="file-row empty">No files available.</div>
    {% endfor %}
  </div>
</div>

<div class="pagination">
  <span class="step-links">
    {% if files.has_previous %}
      <a href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">&laquo; first</a>
      <a href="?page={{ files.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">previous</a>
    {% endif %}

    <span class="current">
      Page {{ files.number }} of {{ files.paginator.num_pages }}.
    </span>

    {% if files.has_next %}
      <a href="?page={{ files.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">next</a>
      <a href="?page={{ files.paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">last &raquo;</a>
    {% endif %}
  </span>
</div>
{% endblock %}
